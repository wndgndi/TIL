# 프로세스 구조

프로그램의 실행 단위를 프로세스라고 한다.  프로세스는 '일반적'으로 아래와 같이 구성되어 있다.

<Br>

![process](https://images.velog.io/images/gndan4/post/a899c29d-ff14-4f34-9499-ad3a095ac8f3/image.png)

<br>

|text(CODE)|data|
|----------|----|
|컴파일된 소스 코드가 저장되는 영역(*기계어로 번역되어 적재되어 있다.*)|전역 변수/초기화된 데이터가 저장되는 영역|

<br>

|stack|heap|
|-----|----|
|임시 데이터(함수 호출, 로컬 변수 등)가 저장되는 영역|코드에서 동적으로 생성되는 데이터가 저장되는 영역  (*메모리 할당된 변수들을 관리한다.*)|

<br>

data는 정적 및 전역 변수가 적재되어 있다. DATA와 BSS로 나뉘는데, 각각 초기화된 것과 초기화되지 않은 것을 관리한다.


함수를 실행하게 되면 함수의 결과가 리턴될 주소가 스택에 저장되고, 함수의 지역 변수들이 차례로 스택에 쌓이게 된다.

함수가 다 실행되고 나면 스택에 있던 데이터들이 차례로 삭제되고, 스택에 저장되어 있던 리턴될 주소 또한 지워지면서 그 주소로 이동하게 된다.
이렇듯 스택을 이용하여 만든, 함수를 실행하기 위한 구조를 `스택 프레임`이라고 한다.​

프로세스에서 Text, DATA, BSS는 실행되자마자 고정된 메모리를 가진다. 
하지만 Stack은 위 → 아래,   Heap은 아래 → 위로 메모리 적재량이 유동적으로 바뀐다.
둘 다 Stack 자료구조 형식으로 LIFO이다.

<br>

---

## 프로세스와 컴퓨터 구조

​

-  PC(Program Counter)
: 코드를 한 줄 한 줄 가리키는 주소 레지스터. 
즉, 다음에 실행할 코드의 주소이다.
​

-  SP(Stack Pointer)
: 함수가 실행될 때 스택 프레임의 최상단 주소를 가리키는 레지스터.

​​
***EAX는 함수의 반환 값을 저장한다.***

<br>

---

## 함수 실행 예시 (컴퓨터 구조)
​
![func ex](https://images.velog.io/images/gndan4/post/474155a0-6d41-46a2-ac8e-161a95d92812/image.png)

<br>

코드 예시는 파이썬이며, 본래 파이썬은 인터프리터 언어이지만 예시에서는 컴파일러 언어로 가정하고 이해한다.

<br>

```
-  EAX 레지스터에는 리턴할 결과값이 담기게 된다.


-  함수가 호출되면 현재 스택 포인터의 최상단 값을 스택에도 저장하고 EBP 라는 레지스터에도 저장하게 된다. 
   EBP는 Stack의 최상단 주소를 담은 레지스터이다. 이는 함수를 타고 들어가다 문제가 발생했을 때 빠르게 추적하기 위해 존재한다.


-  함수를 리턴할 때 스택에 담겨있는 변수들을 차례로 삭제하고, 리턴 주소도 삭제하고, 함수를 실행할 때 스택에 저장된 EBP 레지스터의 값도
   삭제가 된다. 그리고 나서 PC가 리턴 주소를 가리키게 다음 코드가 실행된다.


-  이때, c에는 EAX 레지스터에 들어있던 값이 할당되고, DATA에 들어 있는 C의 값도 갱신된다.
```